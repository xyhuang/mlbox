
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation site for MLCube">
      
      
      
      
        <meta name="author" content="<MLPerf.org> mlcommons@googlegroups.com">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>GCP Runner - MLCube</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/circular.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#google-compute-platform-gcp-runner" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="MLCube" class="md-header-nav__button md-logo" aria-label="MLCube">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            MLCube
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              GCP Runner
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MLCube" class="md-nav__button md-logo" aria-label="MLCube">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MLCube
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      Getting Started
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/hello-world/" class="md-nav__link">
      Hello World
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/mnist/" class="md-nav__link">
      MNIST
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      Tutorials
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/create-mlcube/" class="md-nav__link">
      How to Create an MLCube
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    <label class="md-nav__link" for="nav-4">
      Runners
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Runners" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Runners
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" class="md-nav__link">
      Runners
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker-runner/" class="md-nav__link">
      Docker Runner
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../singularity-runner/" class="md-nav__link">
      Singularity Runner
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ssh-runner/" class="md-nav__link">
      SSH Runner
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kubernetes/" class="md-nav__link">
      Kubernetes Runner
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        GCP Runner
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      GCP Runner
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-remote-instances" class="md-nav__link">
    Creating remote instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-configuration-file" class="md-nav__link">
    Platform configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-runner-configure-phase" class="md-nav__link">
    GCP runner configure phase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-runner-run-phase" class="md-nav__link">
    GCP runner run phase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    Recommendations
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-remote-instances" class="md-nav__link">
    Creating remote instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#platform-configuration-file" class="md-nav__link">
    Platform configuration file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-runner-configure-phase" class="md-nav__link">
    GCP runner configure phase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcp-runner-run-phase" class="md-nav__link">
    GCP runner run phase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    Recommendations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="google-compute-platform-gcp-runner">Google Compute Platform (GCP) Runner<a class="headerlink" href="#google-compute-platform-gcp-runner" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>DISCLAIMER</strong> MLCube is under active development. Allocating and using instances in clouds are associated with
costs. Users of GCP runners should be aware about it, especially, taking into account capability of GCP runners to
automatically create and start remote instances. GCP RUNNERS in current implementation DO NOT stop/destroy remote
instances. Users are encouraged to visit web consoles to identify what virtual instances exist and run.</p>
<p>GCP runner can update users' <code>${HOME}/.ssh/config</code> configuration files.</p>
</blockquote>
<p>GCP runner is a frontend runner for running MLCubes in Google cloud. It is called a frontend runner because it does not
actually run cubes, but ensures that a remote instance is up and running, and then uses other runners to actually run
MLCubes. The following chain of runners is supported and has been tested:
1. A user interacts with GCP runners. These runners are responsible for creating remote instances (if they do not 
   exist), start them, install required software stack (such as docker or singularity).
2. Once a remote instance is up and running, GCP runners delegates further execution to other runners, such as 
   <a href="https://mlcommons.github.io/mlcube/runners/ssh-runner/">SSH runners</a>. SSH runners are responsible for delivering
   MLCubes to remote instances. SSH runners then delegate the actual execution of cubes on those remote instances to
   such runners as <a href="https://mlcommons.github.io/mlcube/runners/docker-runner/">docker runner</a> or 
   <a href="https://mlcommons.github.io/mlcube/runners/singularity-runner/">singularity runner</a>.</p>
<p>The described scenario assumes the presence of the following platform configuration files: GCP, SSH and one of Docker or
Singularity. As MLCube project evolves, other paths may become possible to run cubes in clouds such as GCP.</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<p>To use GCP runners, users need to have a GCP account. The following account details must be known and available in
advance:
1. Project ID.
2. Zone.
3. Service account <a href="https://cloud.google.com/docs/authentication/production#create_service_account">JSON file</a>.
4. Users should configure their GCP accounts so that ever new virtual instance is automatically deployed with user 
   public key making it available through SSH access automatically.</p>
<h2 id="creating-remote-instances">Creating remote instances<a class="headerlink" href="#creating-remote-instances" title="Permanent link">&para;</a></h2>
<p>Remote instances for running MLCubes can be created manually or automatically. 
1. To create a virtual instance manually, go to GCP console, select <code>Compute Engine</code> and then <code>VM instances</code>. Write
   down an instance name.
2. To create a virtual instance automatically, a GCP platform file needs be configured. A limited functionality is
   supported. Basically, users can only specify <code>machine type</code> and <code>disk size</code>. Ubuntu 18.04 OS will be used as a base
   image.</p>
<h2 id="platform-configuration-file">Platform configuration file<a class="headerlink" href="#platform-configuration-file" title="Permanent link">&para;</a></h2>
<p>The following is an example of the actual GCP platform configuration file used in one of the tutorials:
<div class="highlight"><pre><span></span><code><span class="c1"># GCP login credentials</span>
<span class="nt">gcp</span><span class="p">:</span>
    <span class="c1"># These are your project ID and zone names. </span>
    <span class="nt">project_id</span><span class="p">:</span> <span class="s">&#39;atomic-envelope-293722&#39;</span>
    <span class="nt">zone</span><span class="p">:</span> <span class="s">&#39;us-central1-a&#39;</span>
    <span class="nt">credentials</span><span class="p">:</span>
        <span class="c1"># As described above, ensure you have servuce account activated and download your JSON key file.</span>
        <span class="nt">file</span><span class="p">:</span> <span class="s">&#39;${HOME}/.gcp/service_account_key_file.json&#39;</span>
        <span class="nt">scopes</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;https://www.googleapis.com/auth/cloud-platform&#39;</span><span class="p p-Indicator">]</span>


<span class="c1"># Instance parameters.</span>
<span class="c1">#    If existing remote instance is used, only `name` field is used. Other fields are not taken into account.</span>
<span class="c1">#    If users want GCP runners to automatically create remote instances, all three fields must present. Instance name</span>
<span class="c1">#       is arbitrary name for this instance. Machine type must be the valid GCP machine type. Ubuntu 18.04 is used</span>
<span class="c1">#       as a base OS. </span>
<span class="nt">instance</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;mlcube-gcp-instance-n1s4&#39;</span>
    <span class="nt">machine_type</span><span class="p">:</span> <span class="s">&#39;n1-standard-4&#39;</span>
    <span class="nt">disk_size_gb</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="c1"># As described above, primary role of GCP runners is to ensure a remote instance exists before delegating the actual</span>
<span class="c1"># `MLCube run` functionality to other runners. Currently, the only available option is a SSH runner (that assumes </span>
<span class="c1"># remote instances are available vis SSH i.e. they have public IPs). The `platform` field below specifies what runner</span>
<span class="c1"># the GCP runner should be using once GCP virtual instance has been created. A SSH runner needs to be configured</span>
<span class="c1"># separately (see sections below for some recommendations and best practices). </span>
<span class="nt">platform</span><span class="p">:</span> <span class="s">&#39;ssh.yaml&#39;</span>
</code></pre></div></p>
<h2 id="gcp-runner-configure-phase">GCP runner <code>configure</code> phase<a class="headerlink" href="#gcp-runner-configure-phase" title="Permanent link">&para;</a></h2>
<p>GCP runners execute the following steps during the configure phase:
1.  Check that SSH access has been configured. A runner loads users <code>${HOME}/.ssh/config</code> file and verifies it 
    contains a section for the remote instance there (specified by the name). The configuration section must define 
    <code>User</code> and <code>IdentityFile</code>.
2. GCP runner connects to GCP using provided project ID, zone name and <code>credentials</code> (file name and scopes).
3. GCP runner checks if a remote instance exists with the provided name. If it does not exist, it creates it using three
   parameters described above - instance name, machine type and disk size.
4. If a remote instance is not running, GCP runner starts it.
5. GCP runner retrieves a remote instance's meta data that includes public IP address. If public IP address does not 
   match <code>HostName</code> in ssh configuration file, <strong>GCP RUNNER UPDATES USER SSH CONFIG FILE</strong>.
6. Currently, GCP runner automatically installs such packages, as <code>docker</code>, <code>python3</code> and <code>virtualenv</code>.
7. GCP runner calls SSH runner to continue configuring remote instance in a MLCube-specific way.</p>
<h2 id="gcp-runner-run-phase">GCP runner <code>run</code> phase<a class="headerlink" href="#gcp-runner-run-phase" title="Permanent link">&para;</a></h2>
<p>GCP runner does not implement any specific logic and redirects its functionality to a SSH runner.   </p>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<ol>
<li>One remote instance can be used to run different MLCubes. Names of remote instances can reflect their type, for
   instance, <code>gcp_free_micro_instance</code>, <code>gcp_4_cpu_instance</code>, <code>gcp_1_gpu_instance</code>, <code>gcp_8_gpu_instance</code> etc.</li>
<li>Following the above guidelines, these instances must be configured with key-based SSH access (GCP and SSH runners
   depend on this). Each remote instance must have a section in the <code>{HOME}/.ssh/config</code> that should look like:
   <div class="highlight"><pre><span></span><code>Host mlcube-gcp-instance-n1s4
    HostName {{PUBLIC_IP_ADDRESS}}
    IdentityFile ~/.ssh/gcp_rsa
    User {{GCP_USER_LOGIN_NAME}}
</code></pre></div>
   GCP runner will update the <code>HostName</code> value if actual IP address differs from existing one. Other fields are never
   updated by GCP runners. Section like this one is sufficient to partially configure GCP and fully configure SSH
   runners.</li>
<li>After every GCP run, decide if a remote instance needs to be stopped/destroyed. If so, go to web console.  </li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../kubernetes/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Kubernetes Runner
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>